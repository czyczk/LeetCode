package main

import "fmt"

func main() {
	s1 := "ABAB"
	k1 := 2
	s2 := "AABABBA"
	k2 := 1
	s3 := "ABBBABAAAAAAABAAAAAAAAABAAAABBBABBBBABBBBAABBBBBBBBBBAABBBABABAAAAAABABBABBBBBAABAABBBBBABAAAAAAABBABBABBBBABBAABAABBAAAAABAABBAAABAABAABABBABABAAABAABBABBABAAAAAABABAAABBABAABBBABBAAAABAABBABBAAABBABBAAABAABAAABAABABAABAABBBABABBBAABBBABBAAAABAAAABBBBABABBBAABAABABAAAAAABABBBAABBABABABBAAAABBBBBABBABAAABABABAAABBABBBAAAAAAAAAAAABABBBAAABAAABBAABAABABBAABBBAABABBBBBBABAABABBABBAABABBABBAAAABABBBBBBAABABBBAAABABBABABBABABBBBABABBABABBBABBAAABBAABABAABAAAAAABABAAABAABBAAABBBBBBABBBAAAABBBAABBBABABAABABBBBABBBBAAAAABAABAAAABABBAABAABBBABBBAABAABBAAABAAABABAABABABAAAAABBAAAAAAAAABAABAAAAABAAABABBBBABABAABABABAABAAAAAABBABBBBBBBAABBABABABAABABBAABAABAABAAAAAAAAAAABBABABBBABBBBAABBBBAABABABABAABABBBAAAABBBBABBAABAAABABAAAAABBBBBBBABBBABABBBBBAABBABAAABABBAABAABBBABAABBAABAAABBABBBBAABBAAABAAAABBBAABABAABBABBBABBBAABBBBAAABBBBAABBBBAAABAAAAABBABBAAAABAAABAAAAAABBBABBBAABBBAABABBBABBBBBAABBAABBBBBBBABABBABBBBBABBAAAAAABABBABABAAAAAAABBABBABAABBBAAABBABBABAABBAAABABAAABABABBABBABAABAABBAABBABABAAABBBAAABABBBAAABABAAABABABAABABABBABBBBBBABABABABAABABBAAAABBBBBBBBBABBBBAABABAAABAABAABABAABABBBBAABAABAAAAABAAABBBBBABAABABBBAABAABAAAAABBABBAAABAAABBBBABAABBBBBBBBAAABAABBBBBAABBAAABABBBAAAABBBBBAABBBBBBBABBABABAAAABABBBBBBBABAABABABABBBAAABAAAAABABBABABBBBBBABABAAABABBAABBABAABBAABBBBAABBBBAABBBBAABBABABBAABAABABAABBBBAABAABBAAABBBBABBAABAAAABBAABBAAABBABABBBBAAAAAABABAAAAABAABBBABABABBBAABAABAABBAAAAAABBBBABAABAABBBAAABBBBAABBABABBBBBABBAAAAABBBBAABBBBABAAAAAABAAABBABAABBAABBAAAAAAABBABAAAAAABBAABAABBAABAAAABBBBAAABABBAABAABBBABBBBBABBBAABBBBAAAABAABABABABBBBBABAAABABABBBAAAABAAAABAABABAABAAAABAABBAABABABABBBAAABBBAABAABBAABBBBBABAABBBAAABBBABBABAABAABBBBABBABAAABAAAAAABBAABBABAAAAAABABAAABBBAABBBAABAAABAABBBAABBABAAAAAABBBAABAAAAABBABAAABAABABABABAABBABABBBABAAABABABBBBBAAABABAABAAAABBBBBBAABBAAABBAAAAAAAABBABBBBAABBABBAAAABABABABAAABAAAAABBAAAAAABAABBABAAABBAABBBAAAAAABBAAAABBBABBABBBBBABABAAABAAAABABBBABAAABBABAAAAAAAABBAAABBAAABBBBAAABBBBBAAAABABABABABAABAABBAAAABBBBBBABABBBBABBAAABBBAABAABABAABABAABBAAAAABBABAAAAAABBBABAABABABBAABBBBBAAABAABABAAABBBBAABAABBAAABABAABAAAABABBAABAABABAABAAABAABAABABBABBABBABBBBAAABBABBAABBBBAABBAABBAABBABBABAAAAAABBAAAABABBABABAABBBAABABAABAABBBAAAAAAABAAAABBBAABABABBBAABABABBBBBAABABBAAABABAABBBBAAAABBABBBBBABABAAAABAAABBBABBBAABABBBBAAAABBABAAABAABABAAAAABABBBAAABBBAAAAAABABBABBBABABBABBBABBBAAAAAAAABBAABABABBABBBAAABABBABAAABAABBBABAAAABAAAABBABAAAABABAAAAABBBAABAAABBBABAAABBAAABBBABBAAABBBABBBBABABBBABBBAAAABBBAABBABABABBABBAABAAAABAABBBAAAABAAABABAABBAAABAABAAABBABAABABAABBBAABBAAABBABBAABABABABBABBBBABAABABBBABBBBABBABBBBAAABABAABBABBBBBABAABABBABBBBBAAAABABABBAAABABABABBBBAAAAAABABBBABBBBABABBABBAABBABABBAABAAAAABABAAAABABBAABBBBBBBBAAAABAAABAABABBBBABABAABAAAAAABAAAAAABAAAAAAAABBAAAAABBAAABBAAAABBBABAABBBBBABAABAAABBAABBBBABBBBAABBABBBBAAABABBBABBAABABABAAABAAAABBBABBBBBBBBABBBAAABBABBAAABBABABBBABBABBAAAABBBBABABBAAABAAAAABBBBBBAABBAAAABABAAABBBAABBABABABAAAAABBBBAABAABBAABBABABBBABAABABBBBAABAAABABBAABAABBAABBBABBBBAAABABBBBBBBBBABAAAAAAAAABABABBBBBBAABBAAABAAABABBAAAABBABBAABBABBBABBBBABAABBBBAABABAAAABABBBBBBBBAABAAABABAAABBAABABAABBBBBBBBABBABABAABBAABBBBABBAAAABBABABABAAABABAABABBAABBAABABBBAABBABABBABAAABAAAAABBAAABBABABBBAABAAABBBABAABABAABAAAAABABAABABBAAABABABBBABBABBBBBBABAABABAABBAABAAAABBABABBBBBBABBBAABBABBBAABBABBABBBAABBBBAAABBBBAAAABBBABABABABBAAABBAAABBABABBAAAAAAABBABABABABBABAAAAAABBBAAAABBBAABAABBAABABBAAABABBABBBBBAAAAABBBABBAAABBAABABAAAABBBAABBBBBAAAAABAAAABBAAAABABBABBBABAAAAABBABABAAABABBAABABAABBAABBAAABABABAABAABABBABBAAABAAABAAAABBAAAABAAAAABBBABBBBAAAABBBBAABAABABAABABAAABABBBAABBBBBBBAAAAABABABBAABAABABABBBBBBABABAABABBAABBAABBBBABBBBBBABBAAABBBBABAABAABABAAAAABBABABBAAAABBAABAABBBBBABAAABBAAAABAAABABAAAABAABABAABABABBBAAAABBAAAAABBAABAAABAABABAAAABBAAABBABBBAABBAAABBAAAABBBBBAABBAAABBAAAAAAAABAABABBBBABAABAAABAABABABAAAABAABBAABBAAAAABABBABBAAAAABAAABABBBAAAAABBBAABBAAABBBAAAABAABABBBBABABABABBAAABBABAABABABBABAAAAAABABAAAAAABBABAABABBABBBBABBAAAABAABABABAABBABBBBAABBAAABAABBBBBBBBAAAABBBABABABBBBAABBBBABBABAABBBABBAABBBABBABABABAAABAAABABABABABABABABAABBAAAAAABBBAAABBAAAABAABBAAAAABBBAABBABABBABBBABABBAABBABBBBBAABABBAABABBABBAABABAAABBABBAABBABBAAABAAABBBABBABBABAABBABBAAABBBABBABBBBABBBABABBBBAABBBBABABBBBBAABBBBABBAABAAABBAAAAABBBBBBBABAAABAAABBAAAAABAAAAABBAAAAABBBABABBBBABBAAAAABBAAABBAAABABAAAAAABBABAABABABABAABAABBABBBABBABBAABBBABBABBABABAAAAABBBBAAAABABBABABBBBAABBABBBABBABBAAAABAABBABAAAABBAAAABBAABABBBAABAAAABBBBBABBAAABAAAAABBBBAAABABABABBABBBAABAABAABABABABABAAAABBAAAAABBBAAABBAAAABAAABABAABABBBAABBBABAABBBABAABABBABBAAABBAABBBBBBBBBBBABABBAAABAAABABAABBABBBAAABBABBBABAAABAABAABABABBAAAABAAABABAABBBBBBBAABABABAABBBAABAAAAAAAAAAABAABABBBAAABBAABAABABAABABBBBBBABAAAABBABAAABBBABABAAABABABBABABBBBBBBABAABBAAAABAABBBABABBBAABBBAAAABABABAAABAABAABBBABABABABAAABAAAAABAABAAAABBBBBBABBBAABBAABBAABABAAAABBBBBAAAAAAABABABBBBABBAAABBBBABBBABAAABAAABAAAAABABBABBABBBAABBBABAAAAABBAABBBABBBAABAAAAABBBAABBBBAABAAABABBABAAAABBABBBBBAAABAABABBBBABBAABABBABAABAAABAABBABBABAABBAAAAABBBABBBABBBBBAABABABBABBAAABABABAABBAAABABABBABBBABBBBBBAAABBBBAABBBAABBABBBAAABAAAABBABBAABBAAAABBBABAABABABBAAABBAABAABAABBBABBBABBBABABAAAAAABAABAAABAAABBBABAAAAAAAAABABBBABAAAABBABABABABAABBBABAAABBABABABBABBBABAAAABBBBBABAABAABAABBBABABBAAABAAABABAAAAABABBAABABBAABABABBABAAABABBABABBABABBABAAAABBBBAABBBAABAABAABABBBAAABBBBBAABABAABBABBBABBABAAAABAAAABABAABBAABBBABBBAABAAABABBABBBAAAAABBBAAAAAABBABBAAAABBBBBBBBABABAAABBBABABBBABAAAABAAAAABABBBBABAABAABBBABBBABBAABABABBAABAAABABBBABBAABAAABABBABBBABABBABBBABABABBABABABABBBAAAAABBBBBBBAAABBAABBAAABAABABBABABAAABABBAAAAAAABABBBAABABAAABAAABAAABAABABBBBBAABBABAAAABBBBAAABAABABABAABBBBAAAABABAAABBAABBABBAAABBBAAABABBBBBBABBBABABAAABBABBBBBBAAAABABABABABAABAABBBBBBABBABBAAABABBABAABAAABBAAAAABAAABAAABBAABBBABBAABBABABBBAABBBABABBAAABAAABAABAAABBABBBAABBBABBAAABAAAABBABAAAAABBBABBABAABBBBABAAABABAABABBBBABBBAABBBBBBABBABBABBBAAAAABBABAAABBBBBABBAAABABAABAABBBBBBBABBAAAABAAABABBAABABBBAABAAAABABAABBBAAAAAAABBAAAAAABAABBABAABAAAABAAAAABABABABBAAAAAAAAABBBAAABABBAABAAABBABBABBABABBABBABABBBAAAAABAAABBBBABABBAAAAABABBAAABABABBBBABAAABAABAABBBAAABBAABABAABBAAAAAAAABABABBABAAAABAAAABBBBBBAABBAABAAABABABABBBBBBBBAAAAABBABBBBAABABBAAABBABBBBBBBBAABBABAABAABBABBBBAAABBABBBAABABBAABABAABBBAABAAAAAAAABBBABAABAABABABABABAABABBABABABBAAAAABABBBBAAABBBBBAABBBABABABAABAABAAABBBBBABBAABBAABABBBBBBAAAABABAABBAABBBAABABBAABABBAABBBBAABBBAAAABABBBABBBAAABAABBAAABBBBBBBBABBBBBBBBBAABBABBBAAAAAABABABBBBAABBAABAABBAABAABAABABABAAABBBBBABBABBBABBABAAABBAAAAAABABBBABBBABBBBAABAAAABBAABAAAAABAAAABBBAABBABBBBAAAABBAAABBAABBABBBBBBBABABBABBAABBABBBABABAABABBBABABBAAAAAAAABABBBAABBAAAABBABBAAABBBBBAABAAABBBBBABBBBBABBBBAAABAABABAAAABABABBAAAAABBBABBABAABBAAABBABBBABBBABAAAAAAABAAABBBAAAABAABAAAAABABBAAAAAAABBAAABBBAABAAABBBBBAABBAABBBAABABBAAABBABAABAAABBBAAABABABABAABAAABBBBAAAAAABABAABABBABBAABAABABBABABBBAABABBBAAABABBABBABAABBAABABBAABBABBAAAABBBABBAABAAABABBBBBAABBBBABBBABBBBBBAABBBBABBABAAAABBBBAABBAABBABBBABBABBABABBABAAABABBAABBBBAABABAAABABBBBBBABAAAAAAABABBBABBAAABBBBAABBBBBAABBABBABABABBBAABABAABBBBBAAAAAABBABBABBBBABBBBABAABBAABBBBBAAABABABBBBBBABBBAAAAABABAABAABAABBBABAAAAABABBBBBABBBBBAABBAABABABABBBBBABBBABABBABAAABBBBBABBBBABBAABBAAABAAAABBAABBAAABBAABBBBABBAAABABAAAAABAABBABBABABABBABBBABABABABBABABBBBBABBABBBBABAAAABBBABBAABBAAABABAABBAAAAAAAABABABABAABBAAABBAAABAABBBBBABBBABAAABBAAABAABAAAABBABABABAAABAABABABABABAABABAABBABBBBAABABBAABBBABABAAABAABBAABBBABABBABABBBBABBBBBBAAABBBAAAAABABBABABBABBAAAAAAAAAAABABBABAABAAAAABAAAABAABABABABABABAABBAAABBBBABBABAABABBBABAABBBBAAAAAABBBBBAABABABBBBBABABBBABAAABBAAABAABBBBAAABABBABABBAABAAABAABABAABBAABAAABBBAAAAAAABBBABBBAAAAABAABBABBABBAAAAABBBBBAABBAAABBBAAAAAABABBAABBBBBBAABBBBABBBABAAAAABBABBBBAABAAAABABABBABBBBBAABBBAAABBAAAAABBAABAAAABBBBAAABBBBABBBBABABBABBBABBBABAAAAABABABBBAABAABBBBAAABBBABABABBBBBABBABABABBBABBAAAAAABBAAABABBAABBBBBBBBAAAAABBBBABAABAAABBBBBAAABABABAAAAAABBAABABABBBBABBABAABBAABBABBABAABAAAABBAABABBBABBBBBABABBBBBAABBAAAABBBBABAAABABBBABABBAAABBBBBBBABBBBBBABBAAAABBBAABBABBBABABAABBABBBAAAABAABABAABAABBBABABBABBBBAABBBBABAABBBBABABABBBABAAAABBBBAAABABBAABBBABABBABAAABAAAABBBBABABAABBBABBBBABAABABAAAAABABBBAABAAABAABAAABABAAABABAAABBABBAAAABABABBBBBAABBABAABBBAABBBABAABBABABABBBAAAAAAABBAAAABBBBAAAABAABABBABBBBBBAABAABBABAABBABBAABBABABBABBAABABBABBAAABAAAAABBABBAAABAABBABBBBAAABAAABBBABBBBAAABBABBABBBABAABABBABABAABABABAAAAAABABABBBAABABBABABBAABBABABAAABAAABAABBABBAAAABBBABBAABBAAAABBABBABABBABABAABBAABBBABAABBAAABABBAAABBBBABBBBBABBABBABBBABABBBAABABBABBABBAAAAABAAAAABAAAABBBBABBBBABAAAAAABAAABBBBBBBAABBABBABBBAABBBAAAABBBBAAAABBAAABBBABBABBBBBABABBBAAABAABAABBBBBABBABBBAABBAABAABBAABABBBBABABABABAAAAAAABBABBABBAAABABBBAABAABABABBBBBABAAAAABBABBBBBAAAAABABABABBABABAAAABBABAAAABABBABAABABBBABABBABABBBBABBAABABAAAABABBBBBBABAABBABBBBABABAAABABABBABABAABBABABAAAABABBABAAABABBBBBAABAAABABBBBABAAAAABAABABABABAABABAABABBAABBBABBBBABAABBAAAAAAABBAABBABAABABBBBBBABBBAAABBAABBABBABAABBAABAABBAAABABBBAAAABAAAAAABBBAAABAAAAABBABAABAABBBBBAAABBBAABABBBBBAAABAAABBAABAAAAABABBABBBABBBABABABABBBABAABBBAABBABBABBBBBBAABBBBBAAABBBAABBBAABABBBAAABBABAABBABBBBABABBABAABAABABBABBAABAABABBBBBAAABBABBBBABABABBAAAAABBBAAABAAAABABABBABBBAABBBBABBABAAABAABBAAABABABBBABBABABBABBABABAAABBABBAABABBABAAAABBABBBBAAAABAAABBBAAABBBBBBBAAAAAABBABABBAAABAAABAABAABBABBBBAAABABBBBBBBAABBBABBBABAAABBAAAABAABBBAABABBABAABAAAAABABBBBBBAABAAAABBABABAABBABBBAAAAABBBAAAAAABABBAABABAAABABAABABAABABBBBBABABBBAABBBAAABBBBAABBBBBBABBBABBBBAAAAAAABAABBAABABBBABABABAAABABBBAABBAABAABBBBABAABABBAAAAAABBAABBAABABBABBAAABBBBBAAAABAAAAABBAABBAABBBAABBAABAAABBBBBABABBBABBBBBABAABBAAABBBBABBBBBBBBBBAABABBAAABBBBBBBBBBBBBBAAAAABABBBABBAABBABAAABAABAABABBABBBABABABABBBABAAABBBBAABAABBBAAAAABAABBBABAAAAAABBBAAAAABAAAAAAABABBABABBBBBABBABAAABBBAAABAAABBABBBBABBAABABBBBAABBBABBBBBAABAABABBBBBAABABABABBABABBBABAABBBBABAABABBBAABBABBABABBBBBABBABBBBBABBABBAAAAABBAABAAABBBBABABBBAABAABAAABBBBBABBABABABABBAABBBBBABAAAABABAAAABABB"
	k3 := 909
	s4 := "ABAA"
	k4 := 0

	// Expecting 4
	fmt.Println(characterReplacement(s1, k1))
	// Expecting 4
	fmt.Println(characterReplacement(s2, k2))
	// Expecting 1917
	fmt.Println(characterReplacement(s3, k3))
	// Expecting 2
	fmt.Println(characterReplacement(s4, k4))
}

func characterReplacement(s string, k int) int {
	n := len(s)
	if n < 2 {
		return n
	}

	k = min(n, k)

	freq := make([]int, 26)
	freq[toIdx(s[0])]++
	maxLen := 1
	lastMostFreqCh := s[0]
	remainingK := k

	idxL, idxR := 0, 1
	for idxR < n {
		freq[toIdx(s[idxR])]++
		mostFreqCh := findMostFreqCh(freq, lastMostFreqCh, s[idxR])

		// If the mf ch is still the same, there's no need to recalculate the reamining k
		if mostFreqCh != lastMostFreqCh {
			remainingK = k
			for i := idxL; i < idxR; i++ {
				if s[i] != mostFreqCh {
					remainingK--
				}
			}
		}

		// Check if the ch at idxR needs replacement
		if s[idxR] != mostFreqCh {
			remainingK--
		}

		if remainingK >= 0 {
			// If remainingK >= 0, check if we can update the max length
			maxLen = max(maxLen, idxR-idxL+1)
		} else {
			// If remainingK < 0, shift idxL right. Before that:
			// 1. Release remainingK by 1 if the ch at idxL is not the mostFreqCh
			// 2. Update the freq list
			if s[idxL] != mostFreqCh {
				remainingK++
			}

			freq[toIdx(s[idxL])]--

			idxL++
		}

		idxR++
		lastMostFreqCh = mostFreqCh
	}

	return maxLen
}

func toIdx(b byte) int {
	return int(b) - int('A')
}

func findMostFreqCh(freq []int, lastMostFreqCh, newCh byte) byte {
	lastIdx := toIdx(lastMostFreqCh)
	proposedIdx := toIdx(newCh)
	if freq[proposedIdx] > freq[lastIdx] {
		return byte(proposedIdx + int('A'))
	}

	return byte(lastIdx + int('A'))
}

func min(a, b int) int {
	if a < b {
		return a
	}

	return b
}

func max(a, b int) int {
	if a > b {
		return a
	}

	return b
}
